"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9988],{69988:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var l=a(57437),n=a(2265),s=a(44785),r=a(76548),i=a(61096),c=a(80824),o=a(66124),d=a(98784),m=a(20556),p=a(55393),u=a(48977),x=a(70707),h=a(77691),b=a.n(h);a(60966);var g=a(92613),f=a(4933),j=a(14194);b().Icon.Default.mergeOptions({iconRetinaUrl:g.Z,iconUrl:f.Z,shadowUrl:j.Z});var y=e=>{let{onLocationSelected:t,center:a}=e,s=(0,n.useRef)(null);return(0,l.jsxs)(u.h,{center:a||{lat:51.505,lng:-.09},zoom:13,style:{height:"400px",width:"100%"},children:[(0,l.jsx)(x.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),(0,l.jsx)(()=>{let e=(0,m.Sx)();return(0,n.useEffect)(()=>{a&&(e.setView(a,13),s.current&&s.current.setLatLng(a))},[a,e]),(0,m.$_)("click",e=>{let{lat:a,lng:l}=e.latlng;s.current&&s.current.setLatLng(e.latlng),t({lat:a,lng:l},"Lat: ".concat(a,", Lng: ").concat(l))}),a?(0,l.jsx)(p.J,{position:a,ref:s}):null},{})]})},N=e=>{let{onLocationSelected:t}=e,[a,s]=(0,n.useState)(""),[r,i]=(0,n.useState)([]),c=async e=>{e.preventDefault();let t=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(a));i(await t.json())},o=(e,a,l)=>{t({lat:e,lng:a},l),s(l),i([])};return(0,l.jsxs)("div",{children:[(0,l.jsx)("form",{onSubmit:c,className:"p-2",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[(0,l.jsx)("input",{type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"Buscar ubicaci\xf3n...",className:"p-2 border rounded w-full"}),(0,l.jsx)("button",{type:"submit",className:"mt-2 sm:mt-0 sm:ml-2 p-2 bg-yellow-500 text-white rounded self-center sm:self-auto",children:"Buscar"})]})}),r.length>0&&(0,l.jsx)("ul",{className:"mt-2 mb-2 border rounded p-2",children:r.map(e=>(0,l.jsx)("li",{onClick:()=>o(e.lat,e.lon,e.display_name),className:"cursor-pointer p-4 hover:bg-gray-200",children:e.display_name},e.place_id))})]})},w=a(72107);function v(){let[e,t]=(0,n.useState)({title:"",description:"",tag_ppl:"",location:"",alias:""}),[a,m]=(0,n.useState)([]),[p,u]=(0,n.useState)([]),[x,h]=(0,n.useState)(!1),[b,g]=(0,n.useState)(!1),[f,j]=(0,n.useState)(null),[v,k]=(0,n.useState)(!1),[S,_]=(0,n.useState)(null),[C,Z]=(0,n.useState)(null),[L,E]=(0,n.useState)({lat:51.505,lng:-.09}),U=async e=>{let{name:l,value:n,files:s}=e.target;if("images"===l&&s){if(a.length+s.length>10){j("No se pueden subir m\xe1s de 10 im\xe1genes.");return}h(!0),g(!1),j(null);let e=Array.from(s),t=await Promise.all(e.map(async e=>{try{return await (0,w.Z)(e,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0})}catch(t){return console.error("Error al comprimir la imagen:",t),e}})),l=t.map(e=>URL.createObjectURL(e));m(e=>[...e,...t]),u(e=>[...e,...l]),h(!1)}else t(e=>({...e,[l]:n}))},P=async t=>{t.preventDefault();let l=s.Z.get("auth_token");h(!0),g(!1),j(null);let n=new FormData;n.append("title",e.title),n.append("description",e.description),n.append("tag_ppl",e.tag_ppl),n.append("location",e.location),n.append("alias",e.alias),S&&n.append("latitude",S.toString()),C&&n.append("longitude",C.toString()),a.forEach((e,t)=>{n.append("images[]",e,e.name)});try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/newpost"),{method:"POST",headers:{Authorization:"Bearer ".concat(l)},body:n,credentials:"include"});if(!e.ok){let t=await e.json();throw Error(t.message||"Error al crear la publicaci\xf3n")}g(!0),h(!1)}catch(e){e instanceof Error?j(e.message):j("An unknown error occurred"),h(!1)}},F=(e,a)=>{_(e.lat),Z(e.lng),E(e),t(e=>({...e,location:a}))};return(0,l.jsxs)("div",{className:"max-w-md mx-auto p-2 min-h-screen sm:h-dvh flex flex-col",children:[(0,l.jsx)("h1",{className:"text-black font-bold text-center mt-8 mb-2 font-sans text-2xl dark:text-white",children:"Nuevo Post"}),(0,l.jsxs)("form",{onSubmit:P,className:"flex-1 overflow-auto",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"images",className:"block text-gray-700 font-semibold mb-4",children:"Im\xe1genes"}),(0,l.jsxs)("label",{className:"bg-black dark:text-black dark:bg-green-400 text-white font-semibold py-2 px-4 rounded-md cursor-pointer transition duration-200 ease-in-out w-full text-center",children:["Subir Im\xe1genes",(0,l.jsx)("input",{type:"file",id:"images",name:"images",accept:"image/*",multiple:!0,style:{display:"none"},onChange:U})]}),x&&(0,l.jsx)("div",{className:"text-center mt-2",children:"Cargando..."}),p.length>0&&!x&&(0,l.jsx)("div",{className:"mt-2",children:p.map((e,t)=>(0,l.jsx)("img",{src:e,alt:"Preview",className:"rounded-md border mb-2",style:{maxWidth:"200px",maxHeight:"200px"}},t))}),f&&(0,l.jsx)("div",{className:"text-red-500 text-center mt-2",children:f}),b&&(0,l.jsx)("div",{className:"text-green-500 text-center mt-2",children:"Las im\xe1genes se han cargado correctamente. Post publicado"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"title",className:"block text-gray-700 font-semibold",children:"T\xedtulo"}),(0,l.jsx)("input",{type:"text",id:"title",name:"title",value:e.title,onChange:U,className:"text-black mt-1 p-2 border rounded-md w-full",required:!0})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"tag_ppl",className:"block text-gray-700 font-semibold",children:"Etiqueta Personas"}),(0,l.jsx)("input",{type:"text",id:"tag_ppl",name:"tag_ppl",value:e.tag_ppl,onChange:U,className:"text-black mt-1 p-2 border rounded-md w-full"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"description",className:"block text-gray-700 font-semibold",children:"Descripci\xf3n"}),(0,l.jsx)("textarea",{id:"description",name:"description",value:e.description,onChange:U,rows:4,className:"text-black mt-1 p-2 border rounded-md w-full"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"location",className:"block text-gray-700 font-semibold",children:"Ubicaci\xf3n"}),(0,l.jsx)("input",{type:"text",id:"location",name:"location",value:e.location,readOnly:!0,className:"text-black mt-1 p-2 border rounded-md w-full",hidden:!0}),(0,l.jsx)(r.Z,{onClick:()=>k(!0),className:"mt-2 p-2 bg-yellow-500 text-white rounded-md",children:"Seleccionar Ubicaci\xf3n"})]}),(0,l.jsx)(r.Z,{type:"submit",className:"bg-black dark:bg-green-400 dark:text-black hover:from-red-500 hover:via-pink-500 hover:to-purple-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md mb-4 mt-2 w-full",children:"Publicar"}),(0,l.jsx)("div",{className:"p-8",children:(0,l.jsx)("h1",{children:" "})})]}),(0,l.jsxs)(i.Z,{open:v,onClose:()=>k(!1),fullWidth:!0,maxWidth:"md",children:[(0,l.jsx)(c.Z,{className:"p-0 flex items-center justify-center mt-2",children:"Selecciona la Ubicaci\xf3n"}),(0,l.jsxs)(o.Z,{children:[(0,l.jsx)(N,{onLocationSelected:F}),(0,l.jsx)(y,{onLocationSelected:F,center:L})]}),(0,l.jsx)(d.Z,{children:(0,l.jsx)(r.Z,{onClick:()=>k(!1),color:"primary",children:"Cerrar"})})]})]})}}}]);