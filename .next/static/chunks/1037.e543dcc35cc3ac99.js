"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1037],{1037:function(e,t,a){a.r(t);var s=a(7437),n=a(2265),l=a(2649),o=a(3153),r=a(7583),i=a.n(r),c=a(1326),d=a(468),m=a(511),h=a(335),u=a(166),x=a(9678),f=a(6604);a(9051),a(5291),a(4318),t.default=()=>{let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0),[p,g]=(0,n.useState)(null),[j,w]=(0,n.useState)(null),[b,k]=(0,n.useState)(null),[y,v]=(0,n.useState)(!1),[N,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/user"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");let t=await e.json();k(t.id)}catch(e){e instanceof Error?g(e.message):g("An unknown error occurred"),r(!1)}})()},[]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/feed"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch feed");let a=await e.json();console.log(a),a.message?w(a.message):t(a.posts||[]),r(!1)}catch(e){e instanceof Error?g(e.message):g("An unknown error occurred"),r(!1)}};null!==b&&e()},[b]);let C=async a=>{try{let s=await fetch("".concat("http://localhost:8000","/api/posts/").concat(a,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.Z.get("auth_token"))},credentials:"include"});if(!s.ok)throw Error("Failed to like/unlike the post");let n=await s.json(),o=e.map(e=>e.id===a?{...e,likes:n.liked?[...e.likes,{id:Date.now(),user_id:b,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]:e.likes.filter(e=>e.user_id!==b)}:e);t(o)}catch(e){console.error("Error liking/unliking the post:",e)}},E=async(a,s)=>{try{let n=await fetch("".concat("http://localhost:8000","/api/posts/").concat(a,"/comment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.Z.get("auth_token"))},credentials:"include",body:JSON.stringify({text:s})});if(!n.ok)throw Error("Failed to comment on the post");let o=await n.json(),r=e.map(e=>e.id===a?{...e,comments:[...e.comments,o]}:e);t(r)}catch(e){console.error("Error commenting on the post:",e)}},_=e=>t=>{t.preventDefault(),E(e,new FormData(t.currentTarget).get("comment")),t.currentTarget.reset()},Z=e=>{S(e),v(!0)},T=()=>{S(null),v(!1)};if(a)return(0,s.jsxs)(c.Z,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh",children:[(0,s.jsx)(d.Z,{}),(0,s.jsx)(m.Z,{variant:"body1",className:"ml-2",children:"Cargando..."})]});if(p)return(0,s.jsxs)("div",{children:["Error: ",p]});if(j)return(0,s.jsx)("div",{children:j});let D={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0};return(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-center mx-auto mb-2 mt-0 text-black dark:text-white text-3xl md:text-4xl font-bold decoration-indigo-500 dark:decoration-indigo-300 text-shadow-lg",children:"Publicaciones"}),(0,s.jsx)("ul",{children:e.length>0?e.map(e=>{var t;return(0,s.jsxs)("li",{className:"mb-6 p-4 bg-white rounded shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:e.title}),(0,s.jsx)("p",{className:"mb-2",children:e.content}),e.images&&e.images.length>1?(0,s.jsx)(o.Z,{...D,children:e.images.map((t,a)=>(0,s.jsx)("div",{className:"relative w-full h-96",onClick:()=>Z(t),children:(0,s.jsx)("img",{src:t,alt:e.title,className:"absolute top-0 left-0 w-full h-full object-cover cursor-pointer"})},a))}):e.images.map((t,a)=>(0,s.jsx)("img",{src:t,alt:e.title,className:"mb-2 rounded w-full h-96 object-cover cursor-pointer",onClick:()=>Z(t)},a)),(0,s.jsxs)("small",{className:"block mb-2 text-gray-600",children:["Por: ",(null===(t=e.user)||void 0===t?void 0:t.name)||"Usuario Desconocido"," el ",new Date(e.created_at).toLocaleString()]}),(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(h.Z,{onClick:()=>C(e.id),children:(0,s.jsx)(x.Z,{color:e.likes.some(e=>e.user_id===b)?"error":"secondary"})}),(0,s.jsxs)("span",{children:[e.likes.length," Likes"]}),(0,s.jsx)(h.Z,{children:(0,s.jsx)(f.Z,{})}),(0,s.jsxs)("span",{children:[e.comments.length," Comentarios"]})]}),(0,s.jsxs)("div",{children:[e.comments.map(e=>{var t;return(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsxs)("strong",{children:[(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown",":"]})," ",e.text,(0,s.jsx)("small",{className:"block text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,s.jsxs)("form",{onSubmit:_(e.id),children:[(0,s.jsx)(u.Z,{name:"comment",label:"Add a comment",variant:"outlined",fullWidth:!0,className:"mb-2"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Comentar"})]})]})]},e.id)}):(0,s.jsx)("p",{children:"No posts available"})}),(0,s.jsxs)(i(),{isOpen:y,onRequestClose:T,contentLabel:"Image Modal",className:"absolute inset-0 md:inset-auto md:top-1/2 md:left-1/2 md:transform md:-translate-x-1/2 md:-translate-y-1/2 bg-white p-4 rounded shadow-lg max-h-screen overflow-y-auto flex items-center justify-center md:max-w-3xl md:w-full",overlayClassName:"fixed inset-0 bg-black bg-opacity-75",children:[(0,s.jsx)("button",{onClick:T,className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center",children:"X"}),N&&(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,s.jsx)("img",{src:N,alt:"Selected",className:"max-w-full max-h-full object-contain"})})]})]})}}}]);