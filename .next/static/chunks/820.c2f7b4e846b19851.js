"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[820],{820:function(e,t,a){a.r(t);var n=a(7437),o=a(8977),r=a(707),s=a(5393),i=a(6429);a(966);var l=a(2265),c=a(2649),d=a(7691),h=a.n(d),p=a(9400),u=a(4255),m=a(4956),x=a(1326),j=a(6548);let f=(0,u.uS)((0,n.jsx)(p.Z,{style:{color:"black",fontSize:"24px"}})),g=h().divIcon({html:f,className:"",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});t.default=()=>{let[e,t]=(0,l.useState)([]),[a,d]=(0,l.useState)(null),[h,p]=(0,l.useState)(null),[u,f]=(0,l.useState)(!1),[b,k]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{let e=c.Z.get("auth_token");try{f(!0);let a=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/feed/mapa"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"});if(a.ok){let e=await a.json();t(e)}else{let e=await a.json();p("Error: "+(e.message||"Failed to fetch posts."))}f(!1)}catch(e){p("An error occurred while processing your request."),f(!1)}})()},[]);let w=e=>{d(e)};return(0,n.jsxs)("div",{children:[h&&(0,n.jsx)("div",{className:"error",children:h}),u?(0,n.jsx)("div",{children:"Loading..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.h,{center:[42.1399,.3379],zoom:13,style:{height:"600px",width:"100%"},children:[(0,n.jsx)(r.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 <a href='http://osm.org/copyright'>OpenStreetMap</a> contributors"}),(0,n.jsx)(s.J,{position:[42.1399,.3379],icon:g,eventHandlers:{click:()=>w({id:0,title:"Torres del Obispo",content:"This is Torres del Obispo",latitude:42.1399,longitude:.3379})},children:(0,n.jsx)(i.G,{children:(0,n.jsx)("b",{children:"Torres del Obispo"})})}),e.map(e=>(0,n.jsx)(s.J,{position:[e.latitude,e.longitude],icon:g,eventHandlers:{click:()=>w(e)},children:(0,n.jsx)(i.G,{children:(0,n.jsx)("b",{children:e.title})})},e.id))]}),a&&(0,n.jsxs)(x.Z,{mt:2,children:[(0,n.jsx)("h2",{children:a.title}),(0,n.jsx)("p",{children:a.content}),(0,n.jsx)(j.Z,{onClick:()=>{k(!0)},variant:"contained",color:"primary",children:"Abrir Post"})]}),a&&(0,n.jsx)(m.Z,{postId:a.id,isOpen:b,onClose:()=>{k(!1)}})]})]})}},4956:function(e,t,a){var n=a(7437),o=a(2265),r=a(2649),s=a(3153),i=a(1326),l=a(468),c=a(511),d=a(7594),h=a(335),p=a(166),u=a(9678),m=a(6604);a(9051),a(5291),t.Z=e=>{var t;let{postId:a,isOpen:x,onClose:j}=e,[f,g]=(0,o.useState)(null),[b,k]=(0,o.useState)(!0),[w,y]=(0,o.useState)(null),[v,S]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/user"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");let t=await e.json();S(t.id)}catch(e){e instanceof Error?y(e.message):y("An unknown error occurred"),k(!1)}})()},[]),(0,o.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(a),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch post");let t=await e.json();g(t),k(!1)}catch(e){e instanceof Error?y(e.message):y("An unknown error occurred"),k(!1)}};null!==v&&e()},[v,a]);let Z=async()=>{if(f)try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(a,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to like/unlike the post");let t=(await e.json()).liked?[...f.likes,{id:Date.now(),user_id:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]:f.likes.filter(e=>e.user_id!==v);g({...f,likes:t})}catch(e){console.error("Error liking/unliking the post:",e)}},E=async e=>{if(f)try{let t=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(a,"/comment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include",body:JSON.stringify({text:e})});if(!t.ok)throw Error("Failed to comment on the post");let n=await t.json();g({...f,comments:[...f.comments,n]})}catch(e){console.error("Error commenting on the post:",e)}};return b?(0,n.jsxs)(i.Z,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh",children:[(0,n.jsx)(l.Z,{}),(0,n.jsx)(c.Z,{variant:"body1",className:"ml-2",children:"Cargando..."})]}):w?(0,n.jsxs)("div",{children:["Error: ",w]}):f?(0,n.jsx)(d.Z,{open:x,onClose:j,"aria-labelledby":"post-modal-title","aria-describedby":"post-modal-description",children:(0,n.jsxs)(i.Z,{className:"post-details",sx:{p:4,maxWidth:800,margin:"auto",bgcolor:"background.paper",boxShadow:24,borderRadius:2},children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:f.title}),(0,n.jsx)("p",{className:"mb-2",children:f.content}),f.images.length>0&&(0,n.jsx)(s.Z,{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,children:f.images.map((e,t)=>(0,n.jsx)("div",{className:"relative w-full h-96",children:(0,n.jsx)("img",{src:"".concat("https://backtfg-production-2112.up.railway.app")+e.url,alt:f.title,className:"absolute top-0 left-0 w-full h-full object-cover cursor-pointer"})},t))}),(0,n.jsxs)("small",{className:"block mb-2 text-gray-600",children:["Por: ",(null===(t=f.user)||void 0===t?void 0:t.name)||"Usuario Desconocido"," el ",new Date(f.created_at).toLocaleString()]}),(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)(h.Z,{onClick:Z,children:(0,n.jsx)(u.Z,{color:f.likes.some(e=>e.user_id===v)?"error":"secondary"})}),(0,n.jsxs)("span",{children:[f.likes.length," Likes"]}),(0,n.jsx)(h.Z,{children:(0,n.jsx)(m.Z,{})}),(0,n.jsxs)("span",{children:[f.comments.length," Comentarios"]})]}),(0,n.jsxs)("div",{children:[f.comments.map(e=>{var t;return(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsxs)("strong",{children:[(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown",":"]})," ",e.text,(0,n.jsx)("small",{className:"block text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),E(new FormData(e.currentTarget).get("comment")),e.currentTarget.reset()},children:[(0,n.jsx)(p.Z,{name:"comment",label:"Add a comment",variant:"outlined",fullWidth:!0,className:"mb-2"}),(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Comentar"})]})]})]})}):(0,n.jsx)("div",{children:"Post not found"})}}}]);