"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[820],{820:function(e,t,o){o.r(t);var n=o(7437),s=o(8977),r=o(707),a=o(5393),i=o(6429);o(966);var l=o(2265),c=o(2649),d=o(7691),h=o.n(d),u=o(9400),p=o(4255),m=o(4956),x=o(1326),j=o(6548);let f=(0,p.uS)((0,n.jsx)(u.Z,{style:{color:"black",fontSize:"24px"}})),g=h().divIcon({html:f,className:"",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});t.default=()=>{let[e,t]=(0,l.useState)([]),[o,d]=(0,l.useState)(null),[h,u]=(0,l.useState)(null),[p,f]=(0,l.useState)(!1),[b,k]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{let e=c.Z.get("auth_token");try{f(!0);let o=await fetch("".concat("http://localhost:8000","/api/feed/mapa"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"});if(o.ok){let e=await o.json();t(e)}else{let e=await o.json();u("Error: "+(e.message||"Failed to fetch posts."))}f(!1)}catch(e){u("An error occurred while processing your request."),f(!1)}})()},[]);let w=e=>{d(e)};return(0,n.jsxs)("div",{children:[h&&(0,n.jsx)("div",{className:"error",children:h}),p?(0,n.jsx)("div",{children:"Loading..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.h,{center:[42.1399,.3379],zoom:13,style:{height:"600px",width:"100%"},children:[(0,n.jsx)(r.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 <a href='http://osm.org/copyright'>OpenStreetMap</a> contributors"}),(0,n.jsx)(a.J,{position:[42.1399,.3379],icon:g,eventHandlers:{click:()=>w({id:0,title:"Torres del Obispo",content:"This is Torres del Obispo",latitude:42.1399,longitude:.3379})},children:(0,n.jsx)(i.G,{children:(0,n.jsx)("b",{children:"Torres del Obispo"})})}),e.map(e=>(0,n.jsx)(a.J,{position:[e.latitude,e.longitude],icon:g,eventHandlers:{click:()=>w(e)},children:(0,n.jsx)(i.G,{children:(0,n.jsx)("b",{children:e.title})})},e.id))]}),o&&(0,n.jsxs)(x.Z,{mt:2,children:[(0,n.jsx)("h2",{children:o.title}),(0,n.jsx)("p",{children:o.content}),(0,n.jsx)(j.Z,{onClick:()=>{k(!0)},variant:"contained",color:"primary",children:"Abrir Post"})]}),o&&(0,n.jsx)(m.Z,{postId:o.id,isOpen:b,onClose:()=>{k(!1)}})]})]})}},4956:function(e,t,o){var n=o(7437),s=o(2265),r=o(2649),a=o(3153),i=o(1326),l=o(468),c=o(511),d=o(7594),h=o(335),u=o(166),p=o(9678),m=o(6604);o(9051),o(5291),t.Z=e=>{var t;let{postId:o,isOpen:x,onClose:j}=e,[f,g]=(0,s.useState)(null),[b,k]=(0,s.useState)(!0),[w,y]=(0,s.useState)(null),[v,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/user"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");let t=await e.json();S(t.id)}catch(e){e instanceof Error?y(e.message):y("An unknown error occurred"),k(!1)}})()},[]),(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/posts/").concat(o),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch post");let t=await e.json();g(t),k(!1)}catch(e){e instanceof Error?y(e.message):y("An unknown error occurred"),k(!1)}};null!==v&&e()},[v,o]);let Z=async()=>{if(f)try{let e=await fetch("".concat("http://localhost:8000","/api/posts/").concat(o,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to like/unlike the post");let t=(await e.json()).liked?[...f.likes,{id:Date.now(),user_id:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]:f.likes.filter(e=>e.user_id!==v);g({...f,likes:t})}catch(e){console.error("Error liking/unliking the post:",e)}},E=async e=>{if(f)try{let t=await fetch("".concat("http://localhost:8000","/api/posts/").concat(o,"/comment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.Z.get("auth_token"))},credentials:"include",body:JSON.stringify({text:e})});if(!t.ok)throw Error("Failed to comment on the post");let n=await t.json();g({...f,comments:[...f.comments,n]})}catch(e){console.error("Error commenting on the post:",e)}};return b?(0,n.jsxs)(i.Z,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh",children:[(0,n.jsx)(l.Z,{}),(0,n.jsx)(c.Z,{variant:"body1",className:"ml-2",children:"Cargando..."})]}):w?(0,n.jsxs)("div",{children:["Error: ",w]}):f?(0,n.jsx)(d.Z,{open:x,onClose:j,"aria-labelledby":"post-modal-title","aria-describedby":"post-modal-description",children:(0,n.jsxs)(i.Z,{className:"post-details",sx:{p:4,maxWidth:800,margin:"auto",bgcolor:"background.paper",boxShadow:24,borderRadius:2},children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:f.title}),(0,n.jsx)("p",{className:"mb-2",children:f.content}),f.images.length>0&&(0,n.jsx)(a.Z,{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,children:f.images.map((e,t)=>(0,n.jsx)("div",{className:"relative w-full h-96",children:(0,n.jsx)("img",{src:"".concat("http://localhost:8000")+e.url,alt:f.title,className:"absolute top-0 left-0 w-full h-full object-cover cursor-pointer"})},t))}),(0,n.jsxs)("small",{className:"block mb-2 text-gray-600",children:["Por: ",(null===(t=f.user)||void 0===t?void 0:t.name)||"Usuario Desconocido"," el ",new Date(f.created_at).toLocaleString()]}),(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)(h.Z,{onClick:Z,children:(0,n.jsx)(p.Z,{color:f.likes.some(e=>e.user_id===v)?"error":"secondary"})}),(0,n.jsxs)("span",{children:[f.likes.length," Likes"]}),(0,n.jsx)(h.Z,{children:(0,n.jsx)(m.Z,{})}),(0,n.jsxs)("span",{children:[f.comments.length," Comentarios"]})]}),(0,n.jsxs)("div",{children:[f.comments.map(e=>{var t;return(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsxs)("strong",{children:[(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown",":"]})," ",e.text,(0,n.jsx)("small",{className:"block text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),E(new FormData(e.currentTarget).get("comment")),e.currentTarget.reset()},children:[(0,n.jsx)(u.Z,{name:"comment",label:"Add a comment",variant:"outlined",fullWidth:!0,className:"mb-2"}),(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Comentar"})]})]})]})}):(0,n.jsx)("div",{children:"Post not found"})}}}]);