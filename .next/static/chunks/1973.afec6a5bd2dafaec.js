"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1973],{24956:function(e,t,n){var o=n(57437),r=n(2265),a=n(44785),i=n(43153),c=n(91326),s=n(40468),l=n(80511),d=n(97594),u=n(60335),p=n(6438),h=n(58754),m=n(56604);n(9051),n(55291),t.Z=e=>{var t;let{postId:n,isOpen:f,onClose:g}=e,[x,w]=(0,r.useState)(null),[b,k]=(0,r.useState)(!0),[j,v]=(0,r.useState)(null),[S,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/user"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");let t=await e.json();y(t.id)}catch(e){e instanceof Error?v(e.message):v("An unknown error occurred"),k(!1)}})()},[]),(0,r.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/posts/").concat(n),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch post");let t=await e.json();w(t),k(!1)}catch(e){e instanceof Error?v(e.message):v("An unknown error occurred"),k(!1)}};null!==S&&e()},[S,n]);let Z=async()=>{if(x)try{let e=await fetch("".concat("http://localhost:8000","/api/posts/").concat(n,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to like/unlike the post");let t=(await e.json()).liked?[...x.likes,{id:Date.now(),user_id:S,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]:x.likes.filter(e=>e.user_id!==S);w({...x,likes:t})}catch(e){console.error("Error liking/unliking the post:",e)}},E=async e=>{if(x)try{let t=await fetch("".concat("http://localhost:8000","/api/posts/").concat(n,"/comment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.Z.get("auth_token"))},credentials:"include",body:JSON.stringify({text:e})});if(!t.ok)throw Error("Failed to comment on the post");let o=await t.json();w({...x,comments:[...x.comments,o]})}catch(e){console.error("Error commenting on the post:",e)}};return b?(0,o.jsxs)(c.Z,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh",children:[(0,o.jsx)(s.Z,{}),(0,o.jsx)(l.Z,{variant:"body1",className:"ml-2",children:"Cargando..."})]}):j?(0,o.jsxs)("div",{children:["Error: ",j]}):x?(0,o.jsx)(d.Z,{open:f,onClose:g,"aria-labelledby":"post-modal-title","aria-describedby":"post-modal-description",children:(0,o.jsxs)(c.Z,{className:"post-details",sx:{p:4,maxWidth:800,margin:"auto",bgcolor:"background.paper",boxShadow:24,borderRadius:2},children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-2",children:x.title}),(0,o.jsx)("p",{className:"mb-2",children:x.content}),x.images.length>0&&(0,o.jsx)(i.Z,{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,children:x.images.map((e,t)=>(0,o.jsx)("div",{className:"relative w-full h-96",children:(0,o.jsx)("img",{src:"".concat("http://localhost:8000")+e.url,alt:x.title,className:"absolute top-0 left-0 w-full h-full object-cover cursor-pointer"})},t))}),(0,o.jsxs)("small",{className:"block mb-2 text-gray-600",children:["Por: ",(null===(t=x.user)||void 0===t?void 0:t.name)||"Usuario Desconocido"," el ",new Date(x.created_at).toLocaleString()]}),(0,o.jsxs)("div",{className:"flex items-center mb-4",children:[(0,o.jsx)(u.Z,{onClick:Z,children:(0,o.jsx)(h.Z,{color:x.likes.some(e=>e.user_id===S)?"error":"secondary"})}),(0,o.jsxs)("span",{children:[x.likes.length," Likes"]}),(0,o.jsx)(u.Z,{children:(0,o.jsx)(m.Z,{})}),(0,o.jsxs)("span",{children:[x.comments.length," Comentarios"]})]}),(0,o.jsxs)("div",{children:[x.comments.map(e=>{var t;return(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsxs)("strong",{children:[(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown",":"]})," ",e.text,(0,o.jsx)("small",{className:"block text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,o.jsxs)("form",{onSubmit:e=>{e.preventDefault(),E(new FormData(e.currentTarget).get("comment")),e.currentTarget.reset()},children:[(0,o.jsx)(p.Z,{name:"comment",label:"Add a comment",variant:"outlined",fullWidth:!0,className:"mb-2"}),(0,o.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Comentar"})]})]})]})}):(0,o.jsx)("div",{children:"Post not found"})}},91973:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var o=n(57437),r=n(2265),a=n(44785),i=n(91326),c=n(80511),s=n(23950),l=n(22988),d=n(44839),u=n(11939),p=n(40261),h=n(26259),m=n(48024),f=n(69281),g=n(22960);let x=r.createContext();var w=n(34535),b=n(87542);function k(e){return(0,b.ZP)("MuiGrid",e)}let j=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],v=(0,w.Z)("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map(e=>"spacing-xs-".concat(e)),...["column-reverse","column","row-reverse","row"].map(e=>"direction-xs-".concat(e)),...["nowrap","wrap-reverse","wrap"].map(e=>"wrap-xs-".concat(e)),...j.map(e=>"grid-xs-".concat(e)),...j.map(e=>"grid-sm-".concat(e)),...j.map(e=>"grid-md-".concat(e)),...j.map(e=>"grid-lg-".concat(e)),...j.map(e=>"grid-xl-".concat(e))]),S=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function y(e){let t=parseFloat(e);return"".concat(t).concat(String(e).replace(String(t),"")||"px")}function Z(e){let{breakpoints:t,values:n}=e,o="";Object.keys(n).forEach(e=>{""===o&&0!==n[e]&&(o=e)});let r=Object.keys(t).sort((e,n)=>t[e]-t[n]);return r.slice(0,r.indexOf(o))}let E=(0,m.ZP)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e,{container:o,direction:r,item:a,spacing:i,wrap:c,zeroMinWidth:s,breakpoints:l}=n,d=[];o&&(d=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return[n["spacing-xs-".concat(String(e))]];let o=[];return t.forEach(t=>{let r=e[t];Number(r)>0&&o.push(n["spacing-".concat(t,"-").concat(String(r))])}),o}(i,l,t));let u=[];return l.forEach(e=>{let o=n[e];o&&u.push(t["grid-".concat(e,"-").concat(String(o))])}),[t.root,o&&t.container,a&&t.item,s&&t.zeroMinWidth,...d,"row"!==r&&t["direction-xs-".concat(String(r))],"wrap"!==c&&t["wrap-xs-".concat(String(c))],...u]}})(e=>{let{ownerState:t}=e;return(0,l.Z)({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},"wrap"!==t.wrap&&{flexWrap:t.wrap})},function(e){let{theme:t,ownerState:n}=e,o=(0,u.P$)({values:n.direction,breakpoints:t.breakpoints.values});return(0,u.k9)({theme:t},o,e=>{let t={flexDirection:e};return 0===e.indexOf("column")&&(t["& > .".concat(v.item)]={maxWidth:"none"}),t})},function(e){let{theme:t,ownerState:n}=e,{container:o,rowSpacing:r}=n,a={};if(o&&0!==r){let e;let n=(0,u.P$)({values:r,breakpoints:t.breakpoints.values});"object"==typeof n&&(e=Z({breakpoints:t.breakpoints.values,values:n})),a=(0,u.k9)({theme:t},n,(n,o)=>{var r;let a=t.spacing(n);return"0px"!==a?{marginTop:"-".concat(y(a)),["& > .".concat(v.item)]:{paddingTop:y(a)}}:null!=(r=e)&&r.includes(o)?{}:{marginTop:0,["& > .".concat(v.item)]:{paddingTop:0}}})}return a},function(e){let{theme:t,ownerState:n}=e,{container:o,columnSpacing:r}=n,a={};if(o&&0!==r){let e;let n=(0,u.P$)({values:r,breakpoints:t.breakpoints.values});"object"==typeof n&&(e=Z({breakpoints:t.breakpoints.values,values:n})),a=(0,u.k9)({theme:t},n,(n,o)=>{var r;let a=t.spacing(n);return"0px"!==a?{width:"calc(100% + ".concat(y(a),")"),marginLeft:"-".concat(y(a)),["& > .".concat(v.item)]:{paddingLeft:y(a)}}:null!=(r=e)&&r.includes(o)?{}:{width:"100%",marginLeft:0,["& > .".concat(v.item)]:{paddingLeft:0}}})}return a},function(e){let t,{theme:n,ownerState:o}=e;return n.breakpoints.keys.reduce((e,r)=>{let a={};if(o[r]&&(t=o[r]),!t)return e;if(!0===t)a={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===t)a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{let i=(0,u.P$)({values:o.columns,breakpoints:n.breakpoints.values}),c="object"==typeof i?i[r]:i;if(null==c)return e;let s="".concat(Math.round(t/c*1e8)/1e6,"%"),d={};if(o.container&&o.item&&0!==o.columnSpacing){let e=n.spacing(o.columnSpacing);if("0px"!==e){let t="calc(".concat(s," + ").concat(y(e),")");d={flexBasis:t,maxWidth:t}}}a=(0,l.Z)({flexBasis:s,flexGrow:0,maxWidth:s},d)}return 0===n.breakpoints.values[r]?Object.assign(e,a):e[n.breakpoints.up(r)]=a,e},{})}),N=e=>{let{classes:t,container:n,direction:o,item:r,spacing:a,wrap:i,zeroMinWidth:c,breakpoints:s}=e,l=[];n&&(l=function(e,t){if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return["spacing-xs-".concat(String(e))];let n=[];return t.forEach(t=>{let o=e[t];if(Number(o)>0){let e="spacing-".concat(t,"-").concat(String(o));n.push(e)}}),n}(a,s));let d=[];s.forEach(t=>{let n=e[t];n&&d.push("grid-".concat(t,"-").concat(String(n)))});let u={root:["root",n&&"container",r&&"item",c&&"zeroMinWidth",...l,"row"!==o&&"direction-xs-".concat(String(o)),"wrap"!==i&&"wrap-xs-".concat(String(i)),...d]};return(0,h.Z)(u,k,t)},C=r.forwardRef(function(e,t){let n=(0,f.Z)({props:e,name:"MuiGrid"}),{breakpoints:a}=(0,g.Z)(),i=(0,p.Z)(n),{className:c,columns:u,columnSpacing:h,component:m="div",container:w=!1,direction:b="row",item:k=!1,rowSpacing:j,spacing:v=0,wrap:y="wrap",zeroMinWidth:Z=!1}=i,C=(0,s.Z)(i,S),T=j||v,_=h||v,W=r.useContext(x),z=w?u||12:W,D={},O=(0,l.Z)({},C);a.keys.forEach(e=>{null!=C[e]&&(D[e]=C[e],delete O[e])});let P=(0,l.Z)({},i,{columns:z,container:w,direction:b,item:k,rowSpacing:T,columnSpacing:_,wrap:y,zeroMinWidth:Z,spacing:v},D,{breakpoints:a.keys}),A=N(P);return(0,o.jsx)(x.Provider,{value:z,children:(0,o.jsx)(E,(0,l.Z)({ownerState:P,className:(0,d.Z)(A.root,c),as:m,ref:t},O))})});var T=n(40468),_=n(24956),W=()=>{let[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null),[u,p]=(0,r.useState)(null),[h,m]=(0,r.useState)(!1),[f,g]=(0,r.useState)(1),[x,w]=(0,r.useState)(!0),b=new Set;(0,r.useEffect)(()=>{let e=async e=>{let n=a.Z.get("auth_token");try{s(!0);let o=await fetch("".concat("http://localhost:8000","/api/random-posts?page=").concat(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},credentials:"include"});if(o.ok){let e=await o.json();if(console.log("Data received:",e),e.data.length>0){let n=e.data.filter(e=>!b.has(e.id));n.forEach(e=>b.add(e.id)),t(e=>{let t=[...e,...n];return t.length>12?t.slice(0,12):t})}else w(!1)}else{let e=await o.json();console.error("Error fetching posts:",e),d("Error: "+(e.message||"Failed to fetch posts."))}s(!1)}catch(e){console.error("Exception occurred:",e),d("An error occurred while processing your request."),s(!1)}};x&&e(f)},[f,x]);let k=()=>{n||window.scrollY+window.innerHeight<document.documentElement.scrollHeight||g(e=>e+1)};(0,r.useEffect)(()=>(window.addEventListener("scroll",k),()=>window.removeEventListener("scroll",k)),[n]);let j=e=>{p(e),m(!0)};return(0,o.jsxs)(i.Z,{p:4,children:[l&&(0,o.jsx)(c.Z,{variant:"body1",color:"error",children:l}),(0,o.jsx)(C,{container:!0,spacing:4,children:e.map(e=>(0,o.jsx)(C,{item:!0,xs:12,sm:6,md:4,lg:3,children:(0,o.jsxs)(i.Z,{onClick:()=>j(e),className:"post-thumbnail",sx:{cursor:"pointer",position:"relative",paddingBottom:"100%",overflow:"hidden",borderRadius:2,boxShadow:1},children:[e.images.length>0&&(0,o.jsx)("img",{src:"".concat("http://localhost:8000")+e.images[0].url,alt:e.title,className:"absolute top-0 left-0 w-full h-full object-cover"}),(0,o.jsx)(c.Z,{variant:"h6",className:"post-title",sx:{position:"absolute",bottom:0,left:0,width:"100%",padding:1,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center"},children:e.title})]})},e.id))}),n&&(0,o.jsx)(T.Z,{}),u&&(0,o.jsx)(_.Z,{postId:u.id,isOpen:h,onClose:()=>{m(!1),p(null)}})]})}}}]);