"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1973],{4956:function(e,t,n){var r=n(7437),a=n(2265),o=n(2649),i=n(3153),c=n(1326),s=n(468),l=n(511),d=n(7594),u=n(335),p=n(166),m=n(9678),h=n(6604);n(9051),n(5291),t.Z=e=>{var t;let{postId:n,isOpen:f,onClose:g}=e,[x,w]=(0,a.useState)(null),[b,k]=(0,a.useState)(!0),[j,v]=(0,a.useState)(null),[y,S]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/user"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");let t=await e.json();S(t.id)}catch(e){e instanceof Error?v(e.message):v("An unknown error occurred"),k(!1)}})()},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(n),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to fetch post");let t=await e.json();w(t),k(!1)}catch(e){e instanceof Error?v(e.message):v("An unknown error occurred"),k(!1)}};null!==y&&e()},[y,n]);let Z=async()=>{if(x)try{let e=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(n,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o.Z.get("auth_token"))},credentials:"include"});if(!e.ok)throw Error("Failed to like/unlike the post");let t=(await e.json()).liked?[...x.likes,{id:Date.now(),user_id:y,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]:x.likes.filter(e=>e.user_id!==y);w({...x,likes:t})}catch(e){console.error("Error liking/unliking the post:",e)}},E=async e=>{if(x)try{let t=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/posts/").concat(n,"/comment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o.Z.get("auth_token"))},credentials:"include",body:JSON.stringify({text:e})});if(!t.ok)throw Error("Failed to comment on the post");let r=await t.json();w({...x,comments:[...x.comments,r]})}catch(e){console.error("Error commenting on the post:",e)}};return b?(0,r.jsxs)(c.Z,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh",children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(l.Z,{variant:"body1",className:"ml-2",children:"Cargando..."})]}):j?(0,r.jsxs)("div",{children:["Error: ",j]}):x?(0,r.jsx)(d.Z,{open:f,onClose:g,"aria-labelledby":"post-modal-title","aria-describedby":"post-modal-description",children:(0,r.jsxs)(c.Z,{className:"post-details",sx:{p:4,maxWidth:800,margin:"auto",bgcolor:"background.paper",boxShadow:24,borderRadius:2},children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:x.title}),(0,r.jsx)("p",{className:"mb-2",children:x.content}),x.images.length>0&&(0,r.jsx)(i.Z,{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,children:x.images.map((e,t)=>(0,r.jsx)("div",{className:"relative w-full h-96",children:(0,r.jsx)("img",{src:"".concat("https://backtfg-production-2112.up.railway.app")+e.url,alt:x.title,className:"absolute top-0 left-0 w-full h-full object-cover cursor-pointer"})},t))}),(0,r.jsxs)("small",{className:"block mb-2 text-gray-600",children:["Por: ",(null===(t=x.user)||void 0===t?void 0:t.name)||"Usuario Desconocido"," el ",new Date(x.created_at).toLocaleString()]}),(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)(u.Z,{onClick:Z,children:(0,r.jsx)(m.Z,{color:x.likes.some(e=>e.user_id===y)?"error":"secondary"})}),(0,r.jsxs)("span",{children:[x.likes.length," Likes"]}),(0,r.jsx)(u.Z,{children:(0,r.jsx)(h.Z,{})}),(0,r.jsxs)("span",{children:[x.comments.length," Comentarios"]})]}),(0,r.jsxs)("div",{children:[x.comments.map(e=>{var t;return(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("strong",{children:[(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown",":"]})," ",e.text,(0,r.jsx)("small",{className:"block text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),E(new FormData(e.currentTarget).get("comment")),e.currentTarget.reset()},children:[(0,r.jsx)(p.Z,{name:"comment",label:"Add a comment",variant:"outlined",fullWidth:!0,className:"mb-2"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Comentar"})]})]})]})}):(0,r.jsx)("div",{children:"Post not found"})}},1973:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var r=n(7437),a=n(2265),o=n(2649),i=n(1326),c=n(511),s=n(3950),l=n(2988),d=n(4839),u=n(6575),p=n(261),m=n(6259),h=n(8024),f=n(8510),g=n(2960);let x=a.createContext();var w=n(4535),b=n(7542);function k(e){return(0,b.ZP)("MuiGrid",e)}let j=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],v=(0,w.Z)("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map(e=>"spacing-xs-".concat(e)),...["column-reverse","column","row-reverse","row"].map(e=>"direction-xs-".concat(e)),...["nowrap","wrap-reverse","wrap"].map(e=>"wrap-xs-".concat(e)),...j.map(e=>"grid-xs-".concat(e)),...j.map(e=>"grid-sm-".concat(e)),...j.map(e=>"grid-md-".concat(e)),...j.map(e=>"grid-lg-".concat(e)),...j.map(e=>"grid-xl-".concat(e))]),y=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function S(e){let t=parseFloat(e);return"".concat(t).concat(String(e).replace(String(t),"")||"px")}function Z(e){let{breakpoints:t,values:n}=e,r="";Object.keys(n).forEach(e=>{""===r&&0!==n[e]&&(r=e)});let a=Object.keys(t).sort((e,n)=>t[e]-t[n]);return a.slice(0,a.indexOf(r))}let E=(0,h.ZP)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e,{container:r,direction:a,item:o,spacing:i,wrap:c,zeroMinWidth:s,breakpoints:l}=n,d=[];r&&(d=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return[n["spacing-xs-".concat(String(e))]];let r=[];return t.forEach(t=>{let a=e[t];Number(a)>0&&r.push(n["spacing-".concat(t,"-").concat(String(a))])}),r}(i,l,t));let u=[];return l.forEach(e=>{let r=n[e];r&&u.push(t["grid-".concat(e,"-").concat(String(r))])}),[t.root,r&&t.container,o&&t.item,s&&t.zeroMinWidth,...d,"row"!==a&&t["direction-xs-".concat(String(a))],"wrap"!==c&&t["wrap-xs-".concat(String(c))],...u]}})(e=>{let{ownerState:t}=e;return(0,l.Z)({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},"wrap"!==t.wrap&&{flexWrap:t.wrap})},function(e){let{theme:t,ownerState:n}=e,r=(0,u.P$)({values:n.direction,breakpoints:t.breakpoints.values});return(0,u.k9)({theme:t},r,e=>{let t={flexDirection:e};return 0===e.indexOf("column")&&(t["& > .".concat(v.item)]={maxWidth:"none"}),t})},function(e){let{theme:t,ownerState:n}=e,{container:r,rowSpacing:a}=n,o={};if(r&&0!==a){let e;let n=(0,u.P$)({values:a,breakpoints:t.breakpoints.values});"object"==typeof n&&(e=Z({breakpoints:t.breakpoints.values,values:n})),o=(0,u.k9)({theme:t},n,(n,r)=>{var a;let o=t.spacing(n);return"0px"!==o?{marginTop:"-".concat(S(o)),["& > .".concat(v.item)]:{paddingTop:S(o)}}:null!=(a=e)&&a.includes(r)?{}:{marginTop:0,["& > .".concat(v.item)]:{paddingTop:0}}})}return o},function(e){let{theme:t,ownerState:n}=e,{container:r,columnSpacing:a}=n,o={};if(r&&0!==a){let e;let n=(0,u.P$)({values:a,breakpoints:t.breakpoints.values});"object"==typeof n&&(e=Z({breakpoints:t.breakpoints.values,values:n})),o=(0,u.k9)({theme:t},n,(n,r)=>{var a;let o=t.spacing(n);return"0px"!==o?{width:"calc(100% + ".concat(S(o),")"),marginLeft:"-".concat(S(o)),["& > .".concat(v.item)]:{paddingLeft:S(o)}}:null!=(a=e)&&a.includes(r)?{}:{width:"100%",marginLeft:0,["& > .".concat(v.item)]:{paddingLeft:0}}})}return o},function(e){let t,{theme:n,ownerState:r}=e;return n.breakpoints.keys.reduce((e,a)=>{let o={};if(r[a]&&(t=r[a]),!t)return e;if(!0===t)o={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===t)o={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{let i=(0,u.P$)({values:r.columns,breakpoints:n.breakpoints.values}),c="object"==typeof i?i[a]:i;if(null==c)return e;let s="".concat(Math.round(t/c*1e8)/1e6,"%"),d={};if(r.container&&r.item&&0!==r.columnSpacing){let e=n.spacing(r.columnSpacing);if("0px"!==e){let t="calc(".concat(s," + ").concat(S(e),")");d={flexBasis:t,maxWidth:t}}}o=(0,l.Z)({flexBasis:s,flexGrow:0,maxWidth:s},d)}return 0===n.breakpoints.values[a]?Object.assign(e,o):e[n.breakpoints.up(a)]=o,e},{})}),N=e=>{let{classes:t,container:n,direction:r,item:a,spacing:o,wrap:i,zeroMinWidth:c,breakpoints:s}=e,l=[];n&&(l=function(e,t){if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return["spacing-xs-".concat(String(e))];let n=[];return t.forEach(t=>{let r=e[t];if(Number(r)>0){let e="spacing-".concat(t,"-").concat(String(r));n.push(e)}}),n}(o,s));let d=[];s.forEach(t=>{let n=e[t];n&&d.push("grid-".concat(t,"-").concat(String(n)))});let u={root:["root",n&&"container",a&&"item",c&&"zeroMinWidth",...l,"row"!==r&&"direction-xs-".concat(String(r)),"wrap"!==i&&"wrap-xs-".concat(String(i)),...d]};return(0,m.Z)(u,k,t)},C=a.forwardRef(function(e,t){let n=(0,f.Z)({props:e,name:"MuiGrid"}),{breakpoints:o}=(0,g.Z)(),i=(0,p.Z)(n),{className:c,columns:u,columnSpacing:m,component:h="div",container:w=!1,direction:b="row",item:k=!1,rowSpacing:j,spacing:v=0,wrap:S="wrap",zeroMinWidth:Z=!1}=i,C=(0,s.Z)(i,y),T=j||v,_=m||v,W=a.useContext(x),z=w?u||12:W,D={},O=(0,l.Z)({},C);o.keys.forEach(e=>{null!=C[e]&&(D[e]=C[e],delete O[e])});let P=(0,l.Z)({},i,{columns:z,container:w,direction:b,item:k,rowSpacing:T,columnSpacing:_,wrap:S,zeroMinWidth:Z,spacing:v},D,{breakpoints:o.keys}),A=N(P);return(0,r.jsx)(x.Provider,{value:z,children:(0,r.jsx)(E,(0,l.Z)({ownerState:P,className:(0,d.Z)(A.root,c),as:h,ref:t},O))})});var T=n(468),_=n(4956),W=()=>{let[e,t]=(0,a.useState)([]),[n,s]=(0,a.useState)(!0),[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)(1),[x,w]=(0,a.useState)(!0),b=new Set;(0,a.useEffect)(()=>{let e=async e=>{let n=o.Z.get("auth_token");try{s(!0);let r=await fetch("".concat("https://backtfg-production-2112.up.railway.app","/api/random-posts?page=").concat(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},credentials:"include"});if(r.ok){let e=await r.json();if(console.log("Data received:",e),e.data.length>0){let n=e.data.filter(e=>!b.has(e.id));n.forEach(e=>b.add(e.id)),t(e=>{let t=[...e,...n];return t.length>12?t.slice(0,12):t})}else w(!1)}else{let e=await r.json();console.error("Error fetching posts:",e),d("Error: "+(e.message||"Failed to fetch posts."))}s(!1)}catch(e){console.error("Exception occurred:",e),d("An error occurred while processing your request."),s(!1)}};x&&e(f)},[f,x]);let k=()=>{n||window.scrollY+window.innerHeight<document.documentElement.scrollHeight||g(e=>e+1)};(0,a.useEffect)(()=>(window.addEventListener("scroll",k),()=>window.removeEventListener("scroll",k)),[n]);let j=e=>{p(e),h(!0)};return(0,r.jsxs)(i.Z,{p:4,children:[l&&(0,r.jsx)(c.Z,{variant:"body1",color:"error",children:l}),(0,r.jsx)(C,{container:!0,spacing:4,children:e.map(e=>(0,r.jsx)(C,{item:!0,xs:12,sm:6,md:4,lg:3,children:(0,r.jsxs)(i.Z,{onClick:()=>j(e),className:"post-thumbnail",sx:{cursor:"pointer",position:"relative",paddingBottom:"100%",overflow:"hidden",borderRadius:2,boxShadow:1},children:[e.images.length>0&&(0,r.jsx)("img",{src:"".concat("https://backtfg-production-2112.up.railway.app")+e.images[0].url,alt:e.title,className:"absolute top-0 left-0 w-full h-full object-cover"}),(0,r.jsx)(c.Z,{variant:"h6",className:"post-title",sx:{position:"absolute",bottom:0,left:0,width:"100%",padding:1,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center"},children:e.title})]})},e.id))}),n&&(0,r.jsx)(T.Z,{}),u&&(0,r.jsx)(_.Z,{postId:u.id,isOpen:m,onClose:()=>{h(!1),p(null)}})]})}}}]);